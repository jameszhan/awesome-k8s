1。 TCP协议中是不是所有执行主动关闭的Socket都会进入TIME_WAIT状态呢？
主动关闭的一方在发送最后一个ACK后就会进入TIME_WAIT状态，并停留2MSL（报文最大生存）时间，这是TCP/IP必不可少的，也就是说这一点是“解决”不了的。TCP/IP设计者如此设计，主要原因有两个：
- 防止上一次连接中的包迷路后重新出现，影响新的连接（经过2MSL时间后，上一次连接中所有重复的包都会消失）。
- 为了可靠地关闭TCP连接。主动关闭方发送的最后一个ACK（FIN）有可能会丢失，如果丢失，被动方会重新发送FIN，这时如果主动方处于CLOSED状态，就会响应RST而不是ACK。所以主动方要处于TIME_WAIT状态，而不能是CLOSED状态。另外，TIME_WAIT并不会占用很大的资源，除非受到攻击。

2. 大家来思考一个问题：为什么TIME_WAIT状态还需要等2MSL（报文最大生存时间）后才能返回到CLOSED状态呢？
答案是虽然双方都同意关闭连接了，而且握手的4个报文也都协调好并发送完毕，按理可以直接回到CLOSED状态（就好比从SYN_SEND状态到ESTABLISH状态一样），但是因为我们必须要假设网络是不可靠的，你无法保证最后发送的ACK报文一定会被对方收到，比如对方正处于LAST_ACK状态下的Socket可能会因为超时未收到ACK报文，这时就需要重发FIN报文，所以这个TIME_WAIT状态的作用就是用来重发可能丢失了的ACK报文的。