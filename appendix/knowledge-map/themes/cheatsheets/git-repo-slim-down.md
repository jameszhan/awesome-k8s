# Git 仓库瘦身

大型 Git 仓库可能会导致克隆、拉取更新和其他 Git 操作变得缓慢，而且可能会占用大量磁盘空间。以下是一些减小 Git 仓库大小和提高效率的策略：

### 1. **使用 Shallow Clone**

Shallow Clone 允许您克隆仓库的最近历史，而不是整个历史。这可以大大减少克隆的时间和所需的磁盘空间。

```sh
git clone --depth 1 <repository-url>
```

### 2. **清理大文件**

使用如 [BFG Repo-Cleaner](https://rtyley.github.io/bfg-repo-cleaner/) 或 [filter-repo](https://github.com/newren/git-filter-repo) 的工具，可以帮助您从仓库历史中删除大文件。请注意，这会重写仓库历史，需要谨慎操作。

### 3. **使用 Git LFS**

[Git Large File Storage (LFS)](https://git-lfs.github.com/) 是一种 Git 扩展，用于管理大文件。Git LFS 会将大文件存储在一个单独的服务器上，而在仓库中仅保留一个指针，从而减小了仓库的大小。

### 4. **整理和压缩仓库**

运行 `git gc` 命令可以整理仓库内容，清理无用对象，优化存储并压缩文件。

```sh
git gc --aggressive --prune=now
```

`git gc --aggressive --prune=now` 命令不会丢失 Git 仓库的任何提交历史。这个命令的目的是优化仓库和清理未被任何分支、标签或其他引用引用的对象。

这个命令的组成部分的含义如下：

- `git gc`：这是 Git 的垃圾回收命令，用于优化仓库的存储和清理未被引用的对象。

- `--aggressive`：这个选项会使 Git 更加积极地优化仓库。这可能会花费更多的时间，但通常会释放更多的空间。

- `--prune=now`：这个选项会立即删除所有未被引用的对象。

在运行此命令之前，建议做好仓库备份，以防意外情况导致数据丢失。

### 5. **拆分仓库**

考虑将大型仓库拆分为多个更小的仓库，每个仓库都只包含相关的代码和资源。这可以通过创建子模块或使用其他仓库管理策略来实现。

### 6. **清理旧分支和标签**

定期删除不再需要的旧分支和标签，这有助于减少仓库的大小。

```sh
git branch -d old-branch
git push origin --delete old-branch
```

### 7. **避免将生成的文件存储在仓库中**

避免将编译生成的二进制文件、日志文件、缓存和其他不需要的文件存储在 Git 仓库中。这可以通过正确配置 `.gitignore` 文件来实现。

请注意，一些更改（例如清理大文件和重写历史）可能会影响其他开发人员和构建系统，因此在应用这些更改之前，请确保与团队成员进行沟通，并备份重要数据。