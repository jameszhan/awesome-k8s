# 2021-07-03


#### 自动化部署方案

- PXE (Preboot eXecution Environment的)
- WDS (Windows Deployment Services)
- RedHat所支持的Cobbler
- Ubuntu官方发展的MaaS(Metal as a Service)项目


#### Doug McIlroy对Unix文化做了一些阐释

1. 让每个程序就做好一件事。如果有新任务，就重新开始，不要往原程序中加入新功能而搞得复杂。
2. 假定每个程序的输出都会成为另一个程序的输入，即便那个程序目前可能还不存在。输出中不要有不相关的信息出现，这会形成干扰。避免使用严格的分栏格式或二进制格式输入。尽量避免使用交互式输入。
3. 尽可能早地将设计和编译的软件投入试用，即使是操作系统也不例外，理想情况下，应该在几个星期内。拙劣的代码不值得珍惜，扔掉重写。
4. 优先使用工具而不是晦涩的帮助文档来减轻编程任务的负担。工欲善其事，必先利其器。

#### Rob Pike从编程的角度对Unix文化进行了阐释

- 原则1: 你无法判定程序会在什么地方耗费运行时间。瓶颈经常出现在想不到的地方，所以别急于胡乱找地方改代码，除非你已经证明那儿就是瓶颈所在。
- 原则2: 估量。在你没对代码进行估量，特别是没找到最耗时的那部分之前，别去优化速度。
- 原则3: 花哨的算法在n很小时通常很慢，而n通常很小。花哨算法的常数复杂度很大。除非你确定n很大，否则不要用花哨算法。即使n很大，也优先考虑原则2。
- 原则4: 花哨的算法比简单的算法更容易出bug、更难实现。尽量使用简单的算法配合简单的数据结构。
- 原则5: 数据压倒一切。如果已经选择了正确的数据结构并把一切都组织得井井有条，正确的算法也就不言自明。编程的核心是数据结构，而不是算法。
- 原则6: 没有原则6。


#### Unix编程艺术总结

- 模块原则: 使用简单的接口拼合简单的部件。
- 清晰原则: 清晰胜于机巧。
- 组合原则: 设计时考虑拼接组合。
- 分离原则: 策略同机制分离，接口同引擎分离。
- 简洁原则: 设计要简洁，复杂度能低则低。
- 吝啬原则: 除非确无它法，不要编写庞大的程序。
- 透明性原则: 设计要可见，以便审查和调试。
- 健壮原则: 健壮源于透明与简洁。
- 表示原则: 把知识叠入数据以求逻辑质朴而健壮。
- 通俗原则: 接口设计避免标新立异。
- 缄默原则: 如果一个程序没什么好说的，就沉默。
- 补救原则: 出现异常时，马上退出并给出足够的错误信息。
- 经济原则: 宁化机器一分，不花程序员一秒。
- 生成原则: 避免手工hack，尽量编写程序去生成程序。
- 优化原则: 雕琢前先要有原型，跑之前先学会走。
- 多样原则: 决不相信所谓“不二法门”的断言。
- 扩展原则: 设计着眼未来，未来总比预想来得快。


#### LVS提供了十种不同的负载均衡调度算法

01. 轮询（Round Robin）
    LB将外部请求按顺序轮流分配到集群中的各个RS上。这种算法会均等地对待每一个RS，而不管这个RS上实际的连接数和系统负载情况。
02. 加权轮询（Weighted Round Robin）
    LB会根据RS的不同处理能力来调度访问请求。这样可以保证处理能力强的RS处理更多的访问流量。LB可以自动询问RS的负载情况，并动态地调整其权值。
03. 最少链接（Least Connections）
    LB动态地将网络请求分配给活动链接数最少的RS上。如果集群中的RS具有相似的性能，采用“最少链接”算法可以获得较好的负载均衡效果。
04. 加权最少链接（Weighted Least Connections）
    在集群系统中RS性能差异较大的情况下，LB采用“加权最少链接”调度算法能够优化负载均衡的性能。具有较高权值的RS将承受较大比例的活动链接负载。LB可以自动询问RS的负载情况，并动态地调整其权值。
05. 最小期待延迟（Shortest Expected Delay）
    该调度算法基于前述的WLC调度算法，但是会对WLC遇到的一种特殊情形做处理。比如有A、B、C三个RS的权重分别是1、2、3，而活动链接数也是1、2、3，那么根据WLC算法计算则三个RS都是备选对象，这时WLC会利用随机数来做任意选择。而SED则会选择C，因为它所使用的公式是（Ci+1)/Ui，其中Ci代表活动链接数，Ui代表权值。这个算法可以在这种情形下判断出实际能力更强的RS，那么将请求分配给它则代表拥有最小的延迟。
06. 最少队列（Never Queue）
    该算法是对SED算法的一个调整。当LB发现有RS已经没有活动链接了，则立即将用户请求转发给它，而除此之外，则运用SED算法。如果不采用NQ算法，那么SED算法很可能导致某些性能较差的RS永远都得不到用户的请求，这就破坏了负载均衡的均衡性。
07. 基于局部性的最少链接（Locality-Based Least Connections）
    这种调度算法是针对目标IP地址的负载均衡，目前主要用于缓存（比如Memcache、Redis等）集群系统中。该算法根据请求的目标IP地址找出该目标IP地址最近使用的RS，若该RS是可用的且没有超载，则将请求转发到该RS上；若这样的RS不存在，或该RS超载且有RS处于50%的工作负载，则采用“最少链接”原则选出一个可用的RS，并将该请求发送到这个RS。对于缓存类集群，这样的调度算法可以尽最大可能的满足缓存命中或一致性的需求。
08. 带复制的基于局部性的最少链接（Locality-Based Least Connections with Replication）
    这种调度算法与前述的LBLC算法差不多，也主要是用于缓存集群中。不同之处在于，该调度算法要维护一个目标IP地址到一组RS的映射，而LBLC则是一对一的映射。该算法根据请求的目标IP地址找出目标IP地址对应的RS组，然后再按照“最小链接”原则从这组RS中选出一个来，若没有超载则将请求转发；若超载了，则继续按照“最小链接”原则从整个集群中选出一个RS，并将这个RS加入到组中；与此同时，当该RS组有一段时间没有被修改，则会将最忙的RS从RS组中删除，以降低“复制”的程度。这种算法在做到尽最大可能满足缓存命中或一致性需求的同时，也提高了负载均衡的均衡性。
09. 目标地址散列（Destination Hashing）
    该调度算法会根据用户请求的目标IP进行Hash运算而得到一个唯一的RS。如果这个RS当前可用且未超载，那么就将请求转发给它，否则会告诉用户这个请求失败。大家可能很困惑这种负载均衡调度算法的意义所在，因为它相当于静态绑定了某个RS，破坏了均衡性。但是一味地追求“均衡”则属于狭义的负载均衡。从广义上来讲，保证服务的唯一入口也是一种负载均衡。尤其是当使用LVS做防火墙负载均衡的时候，防火墙需要保持入口的统一，才能更好地对整个链接进行跟踪。另外，把相同的请求转发给相同的缓存服务器，也可以做到最高的缓存命中率。
10. 来源地址散列（Source Hashing）
    该调度算法与DH算法一样，不同的是会根据用户请求的来源IP进行Hash运算而得到一个唯一的RS。它的用途也是针对防火墙集群的，只不过与DH算法相反，SH强调的是对内控制。



- [ ] Try `PXE`+`Kickstart`无人值守安装系统